<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CORTEX | Market Data</title>
    <style>
        @font-face {
            font-family: "Alliance No.1";
            src: url("assets/fonts/Degarism Studio - Alliance No.1 Light.otf") format("opentype");
            font-weight: 300; font-style: normal; font-display: swap;
        }
        @font-face {
            font-family: "Alliance No.2";
            src: url("assets/fonts/Degarism Studio - Alliance No.2 Light.otf") format("opentype");
            font-weight: 300; font-style: normal; font-display: swap;
        }
        :root {
            --bg: #ffffff;
            --fg: #080808;
            --dim: #222222;
            --border: #000000;
            --green: #00aa00;
            --red: #cc0000;
            --font-main: "Alliance No.1", sans-serif;
            --font-mono: "Alliance No.2", sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-font-smoothing: antialiased; }

        body {
            background-color: var(--bg);
            color: var(--fg);
            font-family: var(--font-mono);
            font-size: 15px;
            line-height: 1.4;
            overflow-x: hidden;
            width: 100vw;
            min-height: 100vh;
        }

        .text-dim { color: var(--dim); }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            border-left: 1px solid var(--border);
            border-right: 1px solid var(--border);
            min-height: 100vh;
        }

        header {
            display: grid;
            grid-template-columns: 1fr auto auto auto auto auto auto;
            border-bottom: 1px solid var(--border);
        }

        .logo {
            font-family: var(--font-main);
            font-size: 1.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            padding: 1rem;
            gap: 8px;
        }

        .logo-img { height: 78px; width: auto; display: block; }
        .logo span { font-size: 0.5em; font-family: var(--font-mono); color: var(--dim); }

        .nav-item {
            border-left: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem 1.5rem;
            text-transform: capitalize;
            font-size: 0.7rem;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
            text-decoration: none;
            color: var(--fg);
        }

        .nav-item:hover, .nav-item.active { background: var(--fg); color: var(--bg); }

        .section-header {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border);
            font-size: 0.7rem;
            text-transform: capitalize;
            background: #f5f5f5;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .market-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            border-bottom: 1px solid var(--border);
        }

        .market-grid > div { border-right: 1px solid var(--border); }
        .market-grid > div:last-child { border-right: none; }

        .widget-cell { padding: 0; overflow: hidden; }
        .widget-cell-quotes { height: 550px; }

        .chart-section { height: 700px; position: relative; border-bottom: 1px solid var(--border); }

        .chart-section .tradingview-widget-container,
        .chart-section .tradingview-widget-container__widget {
            width: 100% !important;
            height: 100% !important;
        }

        .heatmap-section { height: 600px; position: relative; }

        .heatmap-section .tradingview-widget-container,
        .heatmap-section .tradingview-widget-container__widget {
            width: 100% !important;
            height: 100% !important;
        }

        .summary-bar {
            border-bottom: 1px solid var(--fg);
            padding: 0;
        }

        .tradingview-widget-copyright { display: none !important; }

        .widget-cell {
            border: 1px solid var(--fg);
        }

        .widget-cell iframe,
        .widget-cell div {
            border-radius: 0 !important;
        }

        .widget-cell iframe {
            border: 1px solid var(--fg) !important;
            border-radius: 0 !important;
        }

        .tradingview-widget-container,
        .tradingview-widget-container__widget {
            border-radius: 0 !important;
        }

        .scanline {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, transparent, rgba(0,0,0,0.02), transparent);
            pointer-events: none; animation: scanline 8s linear infinite; z-index: 100;
        }
        @keyframes scanline { 0% { transform: translateY(-100%); } 100% { transform: translateY(100vh); } }

        @media (max-width: 960px) {
            .market-grid { grid-template-columns: 1fr; }
            header { grid-template-columns: 1fr auto; }
        }

        /* Wallet nav (injected by js/wallet.js) */
        .wallet-connected { position: relative; }
        .wallet-addr { font-family: var(--font-mono); font-size: 0.7rem; letter-spacing: 0.5px; }
        .wallet-dropdown { position: absolute; top: 100%; right: 0; background: var(--bg); border: 1px solid var(--border); min-width: 200px; z-index: 60; display: none; }
        .wallet-dropdown.open { display: block; }
        .wallet-dropdown-item { padding: 0.75rem 1rem; font-size: 0.7rem; text-transform: capitalize; cursor: pointer; transition: background 0.2s; display: flex; align-items: center; gap: 0.5rem; }
        .wallet-dropdown-item:hover { background: #f0f0f0; }
        .wallet-dropdown-item:not(:last-child) { border-bottom: 1px solid var(--border); }
        .wallet-dropdown-item.disconnect { color: var(--red); }
        .wallet-dropdown-item .dd-icon { font-size: 0.6rem; color: var(--dim); width: 14px; text-align: center; }
        .wallet-dropdown-item.disconnect .dd-icon { color: var(--red); }
        .ticker { overflow: hidden; white-space: nowrap; padding: 0.5rem 0; border-bottom: 1px solid var(--border); font-size: 0.7rem; color: var(--dim); background: #f5f5f5; }
        .ticker-content { display: inline-block; animation: marquee 30s linear infinite; }
        .ticker-item { display: inline-block; margin-right: 3rem; }
        .ticker-item .price { color: var(--fg); margin-left: 0.5rem; }
        .ticker-item .change.up { color: var(--green); }
        .ticker-item .change.down { color: var(--red); }
        @keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
    </style>
</head>
<body>
    <div class="scanline"></div>
    <div class="container">
        <div class="ticker">
            <div class="ticker-content" id="tickerContent">
                <span class="ticker-item">Loading live prices...</span>
            </div>
        </div>
        <header>
            <div class="logo">
                <img src="assets/logos/cortex-logo-dark.png" alt="CORTEX" class="logo-img">
                <span>v.0.1.0</span>
            </div>
            <a class="nav-item" href="index.html">← Dashboard</a>
            <div class="nav-item active">Market Data</div>
            <a class="nav-item" href="history.html">History</a>
            <a class="nav-item" href="cerebral.html">Cerebral</a>
            <a class="nav-item" href="tokenomics.html">Tokenomics</a>
        </header>

        <!-- Quotes + Calendar + News Grid -->
        <div class="section-header">
            <span>Market Intelligence</span>
            <span class="text-dim">QUOTES · CALENDAR · NEWS</span>
        </div>
        <div class="market-grid">
            <!-- Market Quotes Widget -->
            <div class="widget-cell widget-cell-quotes">
                <div class="tradingview-widget-container">
                    <div class="tradingview-widget-container__widget"></div>
                    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-market-quotes.js" async>
                    {
                        "colorTheme": "light",
                        "locale": "en",
                        "isTransparent": true,
                        "showSymbolLogo": true,
                        "backgroundColor": "#ffffff",
                        "support_host": "https://www.tradingview.com",
                        "width": "100%",
                        "height": "100%",
                        "symbolsGroups": [
                            {
                                "name": "Solana Ecosystem",
                                "symbols": [
                                    { "name": "TRADENATION:SOLANA", "displayName": "SOL/USD" },
                                    { "name": "BINANCE:SOLBTC", "displayName": "SOL/BTC" },
                                    { "name": "COINBASE:PUMPUSDC", "displayName": "PUMP/USDC" },
                                    { "name": "CRYPTOCAP:USDC", "displayName": "USDC" }
                                ]
                            }
                        ]
                    }
                    </script>
                </div>
            </div>

            <!-- Economic Calendar Widget -->
            <div class="widget-cell widget-cell-quotes">
                <div class="tradingview-widget-container" style="width:100%;height:100%;">
                    <div class="tradingview-widget-container__widget"></div>
                    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-events.js" async>
                    {
                        "colorTheme": "light",
                        "isTransparent": true,
                        "locale": "en",
                        "countryFilter": "",
                        "importanceFilter": "-1,0,1",
                        "width": "100%",
                        "height": "100%"
                    }
                    </script>
                </div>
            </div>

            <!-- Top Stories Widget -->
            <div class="widget-cell widget-cell-quotes">
                <div class="tradingview-widget-container" style="width:100%;height:100%;">
                    <div class="tradingview-widget-container__widget"></div>
                    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-timeline.js" async>
                    {
                        "displayMode": "adaptive",
                        "feedMode": "all_symbols",
                        "colorTheme": "light",
                        "isTransparent": true,
                        "locale": "en",
                        "width": "100%",
                        "height": "100%"
                    }
                    </script>
                </div>
            </div>
        </div>

        <!-- Advanced Chart Section -->
        <div class="section-header">
            <span>SOL Advanced Chart</span>
            <span class="text-dim">TRADENATION:SOLANA</span>
        </div>
        <div class="chart-section">
            <div class="tradingview-widget-container" style="height:100%;width:100%;">
                <div class="tradingview-widget-container__widget" style="height:100%;width:100%;"></div>
                <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js" async>
                {
                    "allow_symbol_change": true,
                    "calendar": false,
                    "details": true,
                    "hide_side_toolbar": false,
                    "hide_top_toolbar": false,
                    "hide_legend": false,
                    "hide_volume": false,
                    "hotlist": true,
                    "interval": "D",
                    "locale": "en",
                    "save_image": true,
                    "style": "8",
                    "symbol": "TRADENATION:SOLANA",
                    "theme": "light",
                    "timezone": "Etc/UTC",
                    "backgroundColor": "#ffffff",
                    "gridColor": "rgba(15, 15, 15, 0.06)",
                    "watchlist": [],
                    "withdateranges": true,
                    "range": "1D",
                    "compareSymbols": [],
                    "show_popup_button": true,
                    "popup_height": "650",
                    "popup_width": "1000",
                    "studies": [
                        "STD;24h%Volume",
                        "STD;Advance%1Decline%1Ratio",
                        "STD;Volume%1Delta",
                        "PriceVolumeTrend@tv-basicstudies",
                        "STD;Price%1Target"
                    ],
                    "autosize": true
                }
                </script>
            </div>
        </div>

        <!-- Full-width Heatmap Section -->
        <div class="section-header">
            <span>Crypto Heatmap — Full View</span>
            <span class="text-dim">MARKET CAP · 1H CHANGE</span>
        </div>
        <div class="heatmap-section">
            <div class="tradingview-widget-container" style="width:100%;height:100%;">
                <div class="tradingview-widget-container__widget" style="width:100%;height:100%;"></div>
                <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-crypto-coins-heatmap.js" async>
                {
                    "dataSource": "Crypto",
                    "blockSize": "market_cap_calc",
                    "blockColor": "change|60",
                    "locale": "en",
                    "symbolUrl": "",
                    "colorTheme": "light",
                    "hasTopBar": true,
                    "isDataSetEnabled": true,
                    "isZoomEnabled": true,
                    "hasSymbolTooltip": true,
                    "isMonoSize": false,
                    "width": "100%",
                    "height": "100%"
                }
                </script>
            </div>
        </div>

    </div>

    <script>
        // Override TradingView widget card styles (Shadow DOM + iframe injection)
        const TV_FONT_CSS = `
            @font-face {
                font-family: "Alliance No.2";
                src: url("assets/fonts/Degarism Studio - Alliance No.2 Light.otf") format("opentype");
                font-weight: 300; font-style: normal;
            }
            * { font-family: "Alliance No.2", -apple-system, sans-serif !important; }
        `;

        const TV_OVERRIDE_CSS = `
            * { border-radius: 0 !important; }
            .card, .container, [class*="card"], [class*="Card"],
            [class*="wrapper"], [class*="Wrapper"], [class*="block"], [class*="Block"],
            div[class] { border-radius: 0 !important; }
        `;

        const TV_CARD_BORDER_CSS = `
            * { border-radius: 0 !important; }
            .card, [class*="card"], [class*="Card"] {
                border: 1px solid #080808 !important;
                border-radius: 0 !important;
            }
        `;

        const ALL_CSS = TV_FONT_CSS + TV_OVERRIDE_CSS + TV_CARD_BORDER_CSS;

        function injectStyleToShadow(root) {
            if (!root) return;
            const style = document.createElement('style');
            style.textContent = ALL_CSS;
            root.appendChild(style);

            root.querySelectorAll('iframe').forEach(iframe => {
                try {
                    const doc = iframe.contentDocument || iframe.contentWindow.document;
                    if (doc) {
                        const s = doc.createElement('style');
                        s.textContent = ALL_CSS;
                        doc.head.appendChild(s);
                    }
                } catch(e) {}
            });
        }

        function patchWidgets() {
            document.querySelectorAll('iframe').forEach(iframe => {
                try {
                    const doc = iframe.contentDocument || iframe.contentWindow.document;
                    if (doc && doc.head) {
                        const existing = doc.querySelector('style[data-cortex]');
                        if (!existing) {
                            const s = doc.createElement('style');
                            s.setAttribute('data-cortex', '1');
                            s.textContent = ALL_CSS;
                            doc.head.appendChild(s);
                        }
                    }
                } catch(e) {}
            });

            document.querySelectorAll('.summary-bar iframe, .widget-cell iframe').forEach(iframe => {
                iframe.style.borderRadius = '0';
                iframe.style.border = '1px solid #080808';
            });
        }

        // Run repeatedly as widgets load asynchronously
        let patchCount = 0;
        const patchInterval = setInterval(() => {
            patchWidgets();
            patchCount++;
            if (patchCount > 30) clearInterval(patchInterval);
        }, 500);
    </script>
    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    <script src="js/ticker.js"></script>
    <script src="js/wallet.js"></script>
    <script src="js/toast.js"></script>
</body>
</html>

