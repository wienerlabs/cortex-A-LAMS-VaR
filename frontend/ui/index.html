<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CORTEX | Multi-Agent DeFi Trading System</title>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts-stat@latest/dist/ecStat.min.js"></script>
</head>
<body>
    <div class="scanline"></div>

    <div class="container">
        <!-- Price Ticker -->
        <div class="ticker">
            <div class="ticker-content" id="tickerContent">
                <span class="ticker-item">Loading live prices...</span>
            </div>
        </div>

        <!-- Header -->
        <header>
            <div class="logo">
                <img src="assets/logos/cortex-logo-dark.png" alt="CORTEX" class="logo-img">
                <span>v.0.1.0</span>
            </div>
            <div class="nav-item active" data-nav="dashboard" onclick="switchNav(this)">Dashboard</div>
            <a class="nav-item" href="market.html">Market Data</a>
            <a class="nav-item" href="history.html">History</a>
            <a class="nav-item" href="cerebral.html">Cerebral</a>
            <a class="nav-item" href="tokenomics.html">Tokenomics</a>
            <div class="nav-item wallet-connected" id="walletNav" onclick="handleWalletClick()">
                <span id="walletLabel">Connect Wallet</span>
                <div class="wallet-dropdown" id="walletDropdown">
                    <div class="wallet-dropdown-item" onclick="copyAddress(event)">
                        <span class="dd-icon">&#x2398;</span> Copy Address
                    </div>
                    <div class="wallet-dropdown-item" onclick="viewOnSolscan(event)">
                        <span class="dd-icon">&#x2197;</span> View on Solscan
                    </div>
                    <div class="wallet-dropdown-item disconnect" onclick="disconnectWallet(event)">
                        <span class="dd-icon">&#x23FB;</span> Disconnect
                    </div>
                </div>
            </div>
        </header>

        <!-- ═══════════════════════════════════════════════════════
             HERO: LANDING (wallet NOT connected)
             ═══════════════════════════════════════════════════════ -->
        <div id="heroSection">
            <!-- Hero Banner -->
            <div class="hero">
                <div class="hero-left">
                    <div class="hero-eyebrow">
                        <span class="hero-dot"></span>
                        SOLANA MAINNET &#xB7; LIVE
                    </div>
                    <h1 class="hero-h1">Autonomous<br>DeFi Trading</h1>
                    <p class="hero-p">5 AI agents analyze markets around the clock, debate strategies through adversarial consensus, and execute trades with Guardian risk validation. Deposit USDC, earn yield.</p>
                    <div class="hero-cta-row">
                        <button class="hero-cta" onclick="handleWalletClick()">
                            <span class="hero-cta-icon">&#x26A1;</span>
                            Connect Wallet
                        </button>
                        <div class="hero-cta-sub">Phantom &#xB7; Solflare &#xB7; Backpack &#xB7; +3 more</div>
                    </div>
                </div>
                <div class="hero-right">
                    <div class="hero-kpi">
                        <div class="hero-kpi-label">Vault TVL</div>
                        <div class="hero-kpi-val" id="heroTVL">--</div>
                    </div>
                    <div class="hero-kpi">
                        <div class="hero-kpi-label">Active Agents</div>
                        <div class="hero-kpi-val">5</div>
                    </div>
                    <div class="hero-kpi">
                        <div class="hero-kpi-label">Market Regime</div>
                        <div class="hero-kpi-val" id="heroRegime">--</div>
                    </div>
                    <div class="hero-kpi">
                        <div class="hero-kpi-label">Strategies</div>
                        <div class="hero-kpi-val">3</div>
                    </div>
                    <div class="hero-kpi hero-kpi-wide">
                        <div class="hero-kpi-label">System Status</div>
                        <div class="hero-status-row">
                            <span class="hero-status-chip online">Momentum</span>
                            <span class="hero-status-chip online">Mean Rev</span>
                            <span class="hero-status-chip online">Sentiment</span>
                            <span class="hero-status-chip warning">Risk</span>
                            <span class="hero-status-chip online">Arbitrage</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- How It Works -->
            <div class="steps-bar">
                <div class="step-item">
                    <div class="step-num">01</div>
                    <div class="step-body">
                        <div class="step-title">Connect Wallet</div>
                        <div class="step-desc">Link your Solana wallet. No signup, no KYC. Your keys, your funds.</div>
                    </div>
                </div>
                <div class="step-item">
                    <div class="step-num">02</div>
                    <div class="step-body">
                        <div class="step-title">Deposit USDC</div>
                        <div class="step-desc">Fund the Cortex Vault. Receive shares representing your position. Withdraw anytime.</div>
                    </div>
                </div>
                <div class="step-item">
                    <div class="step-num">03</div>
                    <div class="step-body">
                        <div class="step-title">Agents Trade</div>
                        <div class="step-desc">5 AI agents debate, execute, and manage risk 24/7 through Guardian validation.</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ═══════════════════════════════════════════════════════
             USER SECTION: PORTFOLIO + VAULT (wallet connected)
             ═══════════════════════════════════════════════════════ -->
        <div id="userSection" style="display:none;">

            <!-- Portfolio Top Bar -->
            <div class="ptf-bar">
                <div class="ptf-main">
                    <div class="ptf-label">Total Portfolio</div>
                    <div class="ptf-value" id="portfolioValue">$0.00</div>
                    <div class="ptf-change" id="portfolioChange">--</div>
                </div>
                <div class="ptf-pnl-grid">
                    <div class="ptf-pnl-cell">
                        <div class="ptf-pnl-label">Today</div>
                        <div class="ptf-pnl-val" id="wsPnlToday">--</div>
                        <div class="ptf-pnl-pct" id="wsPctToday"></div>
                    </div>
                    <div class="ptf-pnl-cell">
                        <div class="ptf-pnl-label">This Month</div>
                        <div class="ptf-pnl-val" id="wsPnlMonth">--</div>
                        <div class="ptf-pnl-pct" id="wsPctMonth"></div>
                    </div>
                    <div class="ptf-pnl-cell">
                        <div class="ptf-pnl-label">This Year</div>
                        <div class="ptf-pnl-val" id="wsPnlYear">--</div>
                        <div class="ptf-pnl-pct" id="wsPctYear"></div>
                    </div>
                    <div class="ptf-pnl-cell">
                        <div class="ptf-pnl-label">All Time</div>
                        <div class="ptf-pnl-val" id="wsPnlAll">--</div>
                        <div class="ptf-pnl-pct" id="wsPctAll"></div>
                    </div>
                </div>
            </div>

            <!-- Vault + Holdings Grid -->
            <div class="vu-grid">
                <!-- Vault Card -->
                <div class="vu-vault">
                    <div class="vu-vault-head">
                        <div class="vu-vault-title">
                            <span>Cortex Vault</span>
                            <span class="vu-vault-badge" id="vaultStateBadge">--</span>
                        </div>
                    </div>
                    <div class="vu-vault-body">
                        <div class="vu-vault-metrics">
                            <div class="vu-vm">
                                <div class="vu-vm-label">Your Position</div>
                                <div class="vu-vm-val" id="vaultUserPosition">0.00 USDC</div>
                            </div>
                            <div class="vu-vm">
                                <div class="vu-vm-label">Your Shares</div>
                                <div class="vu-vm-val" id="vaultUserShares">0</div>
                            </div>
                            <div class="vu-vm">
                                <div class="vu-vm-label">Vault TVL</div>
                                <div class="vu-vm-val" id="vaultTVL">--</div>
                            </div>
                        </div>
                        <div class="vu-vault-actions">
                            <button class="vu-btn-deposit" onclick="openVaultModal()" id="vaultDepositBtn">
                                <span class="vu-btn-icon">+</span> Deposit USDC
                            </button>
                            <button class="vu-btn-withdraw" onclick="openVaultModal();setTimeout(function(){vaultSwitchTab('withdraw')},100);">
                                Withdraw
                            </button>
                        </div>
                        <div class="vu-vault-info">
                            <div class="vu-info-item"><span class="vu-info-dot online"></span> Non-custodial vault on Solana</div>
                            <div class="vu-info-item"><span class="vu-info-dot online"></span> Withdraw anytime, no lock-up</div>
                            <div class="vu-info-item"><span class="vu-info-dot online"></span> Guardian-validated execution</div>
                        </div>
                    </div>
                </div>

                <!-- Holdings Card -->
                <div class="vu-holdings">
                    <div class="vu-holdings-head">
                        <span>Wallet Holdings</span>
                        <span class="text-dim" id="wsLiveTag">LOADING...</span>
                    </div>
                    <div class="ws-pnl-banner" id="wsPnlBanner"><span class="ws-pnl-value text-dim">--</span></div>
                    <div class="ws-holdings-row ws-holdings-header"><div>Token</div><div>Balance</div><div>USD Value</div><div>P&L (24h)</div></div>
                    <div id="wsHoldingsBody">
                        <div class="vu-holdings-empty">
                            <div class="vu-empty-icon">&#x1F4B0;</div>
                            <div class="vu-empty-text">Loading wallet data...</div>
                            <div class="vu-empty-sub">Fetching on-chain balances and live prices</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions Bar -->
            <div class="qa-bar">
                <button class="qa-btn" onclick="openVaultModal()">
                    <span class="qa-icon">&#x2B06;</span>
                    <span class="qa-label">Deposit</span>
                </button>
                <button class="qa-btn" onclick="openVaultModal();setTimeout(function(){vaultSwitchTab('withdraw')},100);">
                    <span class="qa-icon">&#x2B07;</span>
                    <span class="qa-label">Withdraw</span>
                </button>
                <a class="qa-btn" href="history.html">
                    <span class="qa-icon">&#x1F4CA;</span>
                    <span class="qa-label">History</span>
                </a>
                <a class="qa-btn" href="cerebral.html">
                    <span class="qa-icon">&#x1F9E0;</span>
                    <span class="qa-label">Cerebral</span>
                </a>
                <a class="qa-btn" href="market.html">
                    <span class="qa-icon">&#x1F4C8;</span>
                    <span class="qa-label">Market</span>
                </a>
            </div>
        </div>

        <!-- ═══════════════════════════════════════════════════════
             MAIN DASHBOARD: 3-Column Technical View
             ═══════════════════════════════════════════════════════ -->
        <div class="dashboard" id="techDashboard">
            <!-- LEFT PANEL: Agent Orchestration -->
            <div class="panel">
                <div class="panel-header">
                    <span>Agent Orchestration</span>
                    <span class="text-green">&#x25CF; LIVE</span>
                </div>

                <!-- Regime Indicator -->
                <div class="regime-indicator">
                    <div class="regime-label">Current Market Regime</div>
                    <div class="regime-header">
                        <div class="regime-value" id="regimeValue">DETECTING...</div>
                        <div class="regime-confidence" id="regimeConfidence">--</div>
                    </div>
                    <div class="regime-bar">
                        <div class="regime-segment"></div>
                        <div class="regime-segment"></div>
                        <div class="regime-segment"></div>
                        <div class="regime-segment"></div>
                        <div class="regime-segment"></div>
                    </div>
                    <div class="regime-labels">
                        <span>Accum</span><span>Markup</span><span>Distrib</span><span>Markdown</span><span>Crisis</span>
                    </div>
                    <div class="regime-gauge-wrap">
                        <svg class="regime-gauge-svg" id="regimeGauge" viewBox="0 0 80 48"></svg>
                        <div>
                            <div class="regime-gauge-text" id="regimeGaugeVal">--</div>
                            <div class="regime-gauge-label">Confidence</div>
                        </div>
                    </div>
                    <div class="regime-probs" id="regimeProbs"></div>
                </div>

                <!-- Data Sources -->
                <div class="ds-panel">
                    <div class="ds-panel-header">
                        <span>Data Sources</span>
                        <span class="text-dim" id="dsStatusSummary">9 Sources</span>
                    </div>
                    <div class="ds-grid" id="dsGrid"></div>
                    <div class="ds-macro" id="dsMacro"></div>
                </div>

                <!-- TX Matrix -->
                <div class="tx-matrix-panel">
                    <div class="tx-matrix-header">
                        <div class="tx-col-idx">IDX</div>
                        <div class="tx-col-data">TX SIGNATURE</div>
                        <div class="tx-col-status">ST</div>
                    </div>
                    <div class="tx-matrix-grid" id="txMatrixContainer">
                        <div class="tx-scanner-bar" id="txScanner"></div>
                    </div>
                </div>

                <!-- Hyperparameters -->
                <div class="hyperparam-section">
                    <div class="hyperparam-coming-soon">COMING SOON</div>
                    <div class="section-label-widget">
                        <span>Hyperparameters</span>
                        <div class="wave-selector">
                            <div class="wave-opt active" onclick="setWave(this)">
                                <svg viewBox="0 0 20 12"><path d="M0 12 C5 12, 5 0, 10 0 S 15 12, 20 12"></path></svg>
                            </div>
                            <div class="wave-opt" onclick="setWave(this)">
                                <svg viewBox="0 0 20 12"><polyline points="0,12 5,12 5,0 15,0 15,12 20,12"></polyline></svg>
                            </div>
                            <div class="wave-opt" onclick="setWave(this)">
                                <svg viewBox="0 0 20 12"><polyline points="0,12 10,0 20,12"></polyline></svg>
                            </div>
                        </div>
                    </div>
                    <div class="param-grid-widget">
                        <div class="param-cell-widget"><div class="param-header-widget"><span>L_RATE</span><span class="param-val-widget" id="val1">0.045</span></div><div class="slider-container-widget" onmousedown="startDrag(event, 'val1', 0.001, 0.1, 3)"><div class="slider-track-widget"></div><div class="slider-thumb-widget" style="left: 45%;"></div></div></div>
                        <div class="param-cell-widget"><div class="param-header-widget"><span>DECAY</span><span class="param-val-widget" id="val2">0.92</span></div><div class="slider-container-widget" onmousedown="startDrag(event, 'val2', 0.1, 1.0, 2)"><div class="slider-track-widget"></div><div class="slider-thumb-widget" style="left: 92%;"></div></div></div>
                        <div class="param-cell-widget"><div class="param-header-widget"><span>MOMTM</span><span class="param-val-widget" id="val3">128</span></div><div class="slider-container-widget" onmousedown="startDrag(event, 'val3', 0, 255, 0)"><div class="slider-track-widget"></div><div class="slider-thumb-widget" style="left: 50%;"></div></div></div>
                        <div class="param-cell-widget"><div class="param-header-widget"><span>BATCH</span><span class="param-val-widget" id="val4">64</span></div><div class="slider-container-widget" onmousedown="startDrag(event, 'val4', 16, 128, 0)"><div class="slider-track-widget"></div><div class="slider-thumb-widget" style="left: 30%;"></div></div></div>
                    </div>
                </div>

                <!-- Performance Graphs -->
                <div class="perf-section">
                    <div class="section-label-widget"><span>Performance Metrics</span><span class="text-dim">FLT.32</span></div>
                    <div class="graph-area-widget">
                        <div class="graph-box-widget"><span class="graph-label-widget">LOSS_FUNC</span><div id="canvasLoss" style="display:flex;align-items:center;justify-content:center;height:100%;font-size:0.6rem;color:var(--dim);font-family:var(--font-mono)">No data</div></div>
                        <div class="graph-box-widget"><span class="graph-label-widget">ACCURACY</span><div id="canvasAcc" style="display:flex;align-items:center;justify-content:center;height:100%;font-size:0.6rem;color:var(--dim);font-family:var(--font-mono)">No data</div></div>
                    </div>
                </div>

                <!-- Trade Mode -->
                <div class="mode-selector">
                    <div class="mode-option active" data-mode="autonomous"><div class="mode-radio"></div><div><div class="mode-name">Autonomous</div><div class="mode-desc">Full agent control</div></div></div>
                    <div class="mode-option" data-mode="semi-auto"><div class="mode-radio"></div><div><div class="mode-name">Semi-Auto</div><div class="mode-desc">Approval required</div></div></div>
                    <div class="mode-option" data-mode="manual"><div class="mode-radio"></div><div><div class="mode-name">Manual</div><div class="mode-desc">Signals only</div></div></div>
                </div>

                <!-- Strategies -->
                <div class="panel-header" style="margin-top:0;"><span>Trading Strategies</span><span class="text-dim" id="stratActiveCount">-- ACTIVE</span></div>
                <div class="strat-panel"><div class="strat-tabs" id="stratTabs"></div><div id="stratBodies"></div></div>

                <!-- Agent Cards -->
                <div class="panel-header" style="margin-top:0;"><span>Agent Status</span><span class="text-dim">5 ACTIVE</span></div>
                <div class="agent-card" data-agent="momentum" onclick="toggleAgentExpand('momentum', this)">
                    <div class="agent-card-header"><span class="agent-name">Momentum Agent</span><div class="agent-status"></div></div>
                    <div class="agent-meta">Trend-following &#xB7; 20-period EMA</div>
                    <div class="agent-metrics"><span class="metric-label">Win Rate</span><span class="metric-value" id="agentWinRate-momentum">--</span><span class="metric-label">Signal</span><span class="metric-value text-dim" id="agentSignal-momentum">--</span></div>
                </div>
                <div class="agent-card" data-agent="meanrev" onclick="toggleAgentExpand('meanrev', this)">
                    <div class="agent-card-header"><span class="agent-name">Mean Reversion Agent</span><div class="agent-status"></div></div>
                    <div class="agent-meta">Bollinger Bands &#xB7; Z-Score</div>
                    <div class="agent-metrics"><span class="metric-label">Win Rate</span><span class="metric-value" id="agentWinRate-meanrev">--</span><span class="metric-label">Signal</span><span class="metric-value text-dim" id="agentSignal-meanrev">--</span></div>
                </div>
                <div class="agent-card" data-agent="sentiment" onclick="toggleAgentExpand('sentiment', this)">
                    <div class="agent-card-header"><span class="agent-name">Sentiment Agent</span><div class="agent-status"></div></div>
                    <div class="agent-meta">NLP &#xB7; Social signals</div>
                    <div class="agent-metrics"><span class="metric-label">Win Rate</span><span class="metric-value" id="agentWinRate-sentiment">--</span><span class="metric-label">Signal</span><span class="metric-value text-dim" id="agentSignal-sentiment">--</span></div>
                </div>
                <div class="agent-card" data-agent="risk" onclick="toggleAgentExpand('risk', this)">
                    <div class="agent-card-header"><span class="agent-name">Risk Agent</span><div class="agent-status warning"></div></div>
                    <div class="agent-meta">VaR &#xB7; Drawdown limits</div>
                    <div class="agent-metrics"><span class="metric-label">Win Rate</span><span class="metric-value" id="agentWinRate-risk">--</span><span class="metric-label">Signal</span><span class="metric-value text-dim" id="agentSignal-risk">--</span></div>
                </div>
                <div class="agent-card" data-agent="arbitrage" onclick="toggleAgentExpand('arbitrage', this)">
                    <div class="agent-card-header"><span class="agent-name">Arbitrage Agent</span><div class="agent-status"></div></div>
                    <div class="agent-meta">Cross-DEX &#xB7; Latency arb</div>
                    <div class="agent-metrics"><span class="metric-label">Win Rate</span><span class="metric-value" id="agentWinRate-arbitrage">--</span><span class="metric-label">Signal</span><span class="metric-value text-dim" id="agentSignal-arbitrage">--</span></div>
                </div>
            </div>

            <!-- CENTER PANEL: Performance + Trades -->
            <div class="panel">
                <div class="panel-header"><span>Performance</span><span class="text-dim">CHARTS &amp; TRADES</span></div>

                <!-- Hidden compat elements for vault-ui.js -->
                <div id="vaultPositionCard" style="display:none;"></div>
                <div class="ws-section" id="walletStatus" style="display:none;">
                    <div class="ws-time-grid" id="wsTimeGrid">
                        <div class="ws-time-cell"><span class="ws-time-label">Today</span><span class="ws-time-value text-dim"></span><span class="ws-time-pct"></span></div>
                        <div class="ws-time-cell"><span class="ws-time-label">This Month</span><span class="ws-time-value text-dim"></span><span class="ws-time-pct"></span></div>
                        <div class="ws-time-cell"><span class="ws-time-label">This Year</span><span class="ws-time-value text-dim"></span><span class="ws-time-pct"></span></div>
                        <div class="ws-time-cell"><span class="ws-time-label">All Time</span><span class="ws-time-value text-dim"></span><span class="ws-time-pct"></span></div>
                    </div>
                </div>

                <!-- P&L Chart -->
                <div class="pnl-chart-section">
                    <div class="panel-header"><span>P&L Performance</span><span class="text-dim">Timeline</span></div>
                    <div class="pnl-chart-filters">
                        <button class="btn btn-sm active" onclick="renderPnlChart('1M', this)">1M</button>
                        <button class="btn btn-sm" onclick="renderPnlChart('3M', this)">3M</button>
                        <button class="btn btn-sm" onclick="renderPnlChart('6M', this)">6M</button>
                        <button class="btn btn-sm" onclick="renderPnlChart('1Y', this)">1Y</button>
                    </div>
                    <div class="pnl-chart-container" id="pnlChart"></div>
                </div>

                <!-- Agent Performance -->
                <div class="agent-perf-section">
                    <div class="panel-header"><span>Agent Performance</span><span class="text-dim">Win Rate</span></div>
                    <div class="agent-perf-container" id="agentPerfChart"></div>
                </div>

                <!-- Agent Clustering -->
                <div class="agent-perf-section">
                    <div class="panel-header"><span>Signal Clustering</span><span class="text-dim">K-Means</span></div>
                    <div id="agentClusterChart" style="width:100%;height:280px;"></div>
                </div>

                <!-- Positions -->
                <div class="positions-section">
                    <div class="panel-header"><span>Active Positions</span><span class="text-dim" id="posCount">0 OPEN</span></div>
                    <div class="positions-grid" id="positionsGrid"></div>
                </div>

                <!-- Guardian -->
                <div class="guardian-section" id="guardianDashboard">
                    <div class="panel-header"><span>Guardian Risk Engine</span><span id="guardianSSEStatus" class="text-dim">CONNECTING...</span></div>
                    <div class="guardian-error" id="guardianError"></div>
                    <div class="guardian-score-banner">
                        <div class="guardian-score-ring"><span class="score-val" id="guardianRiskScore">--</span></div>
                        <div class="guardian-score-info">
                            <div class="guardian-score-decision" id="guardianApproved">WAITING</div>
                            <div class="guardian-score-meta">Token: <span id="guardianToken">--</span> &#xB7; Regime: <span id="guardianRegime">--</span> &#xB7; Size: <span id="guardianSize">--</span> &#xB7; Confidence: <span id="guardianConfidence">--</span> &#xB7; <span id="guardianCache" class="text-dim">--</span></div>
                            <div class="guardian-score-meta">Vetos: <span id="guardianVetos" style="color:var(--dim)">None</span></div>
                        </div>
                    </div>
                    <div class="guardian-assess-bar">
                        <input type="text" id="guardianAssessToken" value="SOL" style="width:60px" placeholder="Token">
                        <input type="number" id="guardianAssessSize" value="10000" style="width:80px" placeholder="Size USD">
                        <select id="guardianAssessDir"><option value="long">Long</option><option value="short">Short</option></select>
                        <select id="guardianAssessStrategy"><option value="">(any)</option><option value="lp">LP</option><option value="arb">Arb</option><option value="perp">Perp</option></select>
                        <button class="btn btn-sm" onclick="runGuardianAssess(document.getElementById('guardianAssessToken').value,parseFloat(document.getElementById('guardianAssessSize').value),document.getElementById('guardianAssessDir').value,document.getElementById('guardianAssessStrategy').value)">Assess</button>
                    </div>
                    <div id="guardianComponents" style="padding:0.25rem 0;border-bottom:1px solid var(--border)"><div style="padding:0.5rem 1rem;color:var(--dim);font-size:0.6rem">Run an assessment to see component scores</div></div>
                    <div style="font-size:0.5rem;text-transform:uppercase;color:var(--dim);padding:0.5rem 1rem 0.25rem;font-weight:600">Kelly Criterion</div>
                    <div class="guardian-stats-grid" id="guardianKelly"><div class="guardian-stat"><div class="guardian-stat-label">Loading...</div><div class="guardian-stat-value">--</div></div></div>
                    <div style="font-size:0.5rem;text-transform:uppercase;color:var(--dim);padding:0.5rem 1rem 0.25rem;font-weight:600">Circuit Breakers</div>
                    <div id="guardianBreakers" style="border-bottom:1px solid var(--border);padding-bottom:0.25rem"><div style="padding:0.5rem 1rem;color:var(--dim);font-size:0.6rem">Loading...</div></div>
                    <div style="font-size:0.5rem;text-transform:uppercase;color:var(--dim);padding:0.5rem 1rem 0.25rem;font-weight:600">Debate Stats (24h)</div>
                    <div class="guardian-stats-grid" id="guardianDebateStats"><div class="guardian-stat"><div class="guardian-stat-label">Loading...</div><div class="guardian-stat-value">--</div></div></div>
                    <div style="font-size:0.5rem;text-transform:uppercase;color:var(--dim);padding:0.5rem 1rem 0.25rem;font-weight:600">Recent Debates</div>
                    <div id="guardianDebates" style="padding-bottom:0.25rem"><div style="padding:0.5rem 1rem;color:var(--dim);font-size:0.6rem">Loading...</div></div>
                </div>

                <!-- Execution Monitor -->
                <div class="em-section">
                    <div class="panel-header"><span>Execution Monitor</span><span class="text-dim" id="emStatus">IDLE</span></div>
                    <div id="emIdleMessage" style="padding:1rem;text-align:center;font-size:0.65rem;color:var(--dim);font-family:var(--font-mono)">Idle -- waiting for next execution</div>
                    <div class="em-pipeline" id="emPipeline" style="display:none">
                        <div class="em-step pending" id="emStep1"><div class="em-step-idx">Step 1</div><div class="em-step-name">TX Simulation</div><div class="em-step-status text-dim">--</div><div class="em-step-bar"><div class="em-step-bar-fill"></div></div></div>
                        <div class="em-step pending" id="emStep2"><div class="em-step-idx">Step 2</div><div class="em-step-name">Guardian</div><div class="em-step-status text-dim">--</div><div class="em-step-bar"><div class="em-step-bar-fill"></div></div></div>
                        <div class="em-step pending" id="emStep3"><div class="em-step-idx">Step 3</div><div class="em-step-name">Broadcast</div><div class="em-step-status text-dim">--</div><div class="em-step-bar"><div class="em-step-bar-fill"></div></div></div>
                        <div class="em-step pending" id="emStep4"><div class="em-step-idx">Step 4</div><div class="em-step-name">Confirm</div><div class="em-step-status text-dim">--</div><div class="em-step-bar"><div class="em-step-bar-fill"></div></div></div>
                    </div>
                    <div class="em-guardian" id="emGuardianSection" style="display:none">
                        <div class="em-guardian-checks">
                            <div style="font-size:0.6rem;font-weight:600;margin-bottom:0.4rem;text-transform:uppercase">Guardian Validator</div>
                            <div class="em-check-row"><span class="em-check-icon" id="emChk1">--</span> TX Simulation</div>
                            <div class="em-check-row"><span class="em-check-icon" id="emChk2">--</span> Slippage</div>
                            <div class="em-check-row"><span class="em-check-icon" id="emChk3">--</span> Balance</div>
                            <div class="em-check-row"><span class="em-check-icon" id="emChk4">--</span> Rate Limit</div>
                        </div>
                        <div class="em-guardian-result">
                            <div style="font-size:0.6rem;font-weight:600;margin-bottom:0.4rem;text-transform:uppercase">Simulation</div>
                            <div style="font-size:0.6rem;color:var(--dim);margin-bottom:0.3rem">Slippage</div>
                            <div class="em-slippage-bar"><span class="em-slip-label">Exp</span><div class="em-slip-track"><div class="em-slip-expected" id="emSlipExp" style="width:0%"></div><div class="em-slip-actual" id="emSlipAct" style="width:0%"></div></div><span class="em-slip-label" style="text-align:right" id="emSlipValues">--</span></div>
                            <div style="font-size:0.6rem;color:var(--dim);margin-bottom:0.3rem;margin-top:0.4rem">Retries</div>
                            <div class="em-retry-timeline" id="emRetryTimeline"><div class="em-retry-dot" style="background:#e8e8e8"></div><div class="em-retry-dot" style="background:#e8e8e8"></div><div class="em-retry-dot" style="background:#e8e8e8"></div><span style="font-size:0.55rem;color:var(--dim);margin-left:4px">--</span></div>
                            <div style="font-size:0.6rem;color:var(--dim);margin-bottom:0.3rem;margin-top:0.4rem">Confirmation</div>
                            <div class="em-confirm-stepper" id="emConfStepper"><div class="em-conf-step">Sub</div><div class="em-conf-step">Proc</div><div class="em-conf-step">Conf</div><div class="em-conf-step">Final</div></div>
                        </div>
                    </div>
                    <div class="em-tx-metrics">
                        <div class="em-tx-metric"><div class="em-tx-label">MEV</div><div class="em-tx-value text-dim" id="emMev">--</div><div class="em-tx-sub">Bundle</div></div>
                        <div class="em-tx-metric"><div class="em-tx-label">Fee</div><div class="em-tx-value text-dim" id="emPriFee">--</div><div class="em-tx-sub">SOL</div></div>
                        <div class="em-tx-metric"><div class="em-tx-label">Latency</div><div class="em-tx-value text-dim" id="emLatency">--</div><div class="em-tx-sub">ms</div></div>
                        <div class="em-tx-metric"><div class="em-tx-label">Status</div><div class="em-tx-value text-dim" id="emTxStatus">--</div><div class="em-tx-sub" id="emTxSig">--</div></div>
                    </div>
                </div>

                <!-- Token Chart -->
                <div class="tv-chart-section">
                    <div class="panel-header"><span>Token Chart</span><span class="text-dim" id="tvPairLabel">SOL / USDC</span></div>
                    <div class="tv-chart-toolbar">
                        <div class="tv-search-wrap"><input type="text" id="tvSearchInput" placeholder="Search token..." autocomplete="off"><div class="tv-search-results" id="tvSearchResults"></div></div>
                        <div class="tv-mode-buttons"><button class="btn btn-sm active" onclick="tvSetMode('price', this)">Price</button><button class="btn btn-sm" onclick="tvSetMode('mcap', this)">MCap</button></div>
                        <div class="tv-tf-buttons">
                            <button class="btn btn-sm" onclick="tvLoadChart(null, 'hour', 1, 168, this)">1W</button>
                            <button class="btn btn-sm active" onclick="tvLoadChart(null, 'hour', 4, 180, this)">1M</button>
                            <button class="btn btn-sm" onclick="tvLoadChart(null, 'day', 1, 90, this)">3M</button>
                            <button class="btn btn-sm" onclick="tvLoadChart(null, 'day', 1, 365, this)">1Y</button>
                        </div>
                    </div>
                    <div class="tv-chart-container" id="tvChartContainer"><div class="tv-loading" id="tvLoading">Loading chart...</div></div>
                </div>

                <!-- Trades -->
                <div class="panel-header trades-header">
                    <div class="tab-group"><div class="tab active" onclick="showTab('active')">Active</div><div class="tab" onclick="showTab('approved')">Approved</div><div class="tab" onclick="showTab('rejected')">Rejected</div></div>
                    <button class="btn btn-sm">Filter</button>
                </div>
                <div class="panel-content" id="trades-container">
                    <div class="trade-row trade-row-header"><div>Pair / Type</div><div>Size</div><div>Status</div><div>Strategy</div></div>
                    <div id="trades-loading" style="text-align:center;padding:2rem;color:var(--dim);font-size:0.75rem;">Loading trades...</div>
                </div>

                <!-- API Heatmap -->
                <div class="api-usage-section">
                    <div class="panel-header"><span>API Usage</span><span class="text-dim">30 Days</span></div>
                    <div class="api-heatmap-container" id="apiHeatmap"></div>
                    <div class="api-legend"><span>Less</span><canvas id="apiLegendBar" class="api-legend-bar" width="120" height="8"></canvas><span>More</span></div>
                </div>
            </div>

            <!-- RIGHT PANEL: Market Intelligence -->
            <div class="panel" id="miPanel">
                <div class="panel-header"><span>Market Intelligence</span><button class="btn btn-sm" onclick="fetchCryptoNews()">&#x21BB;</button></div>
                <div id="miLiveBar"></div>
                <div id="miSentimentStrip"></div>
                <div id="miSentBadges"></div>
                <div id="miSparkline" class="mi-sparkline"></div>
                <div id="miTabs"></div>
                <div id="miFilters"></div>
                <div class="panel-content mi-feed" id="miFeed"><div style="padding:2rem;text-align:center;color:var(--dim);font-size:0.7rem;">Connecting to sources...</div></div>
            </div>
        </div>

        <footer>
            <div>CORTEX AUTONOMOUS TRADING SYSTEM</div>
            <div>SOLANA MAINNET</div>
            <div>&copy;2026 WIENER LABS</div>
        </footer>
    </div>

    <!-- Wallet Modal -->
    <div class="modal-overlay" id="walletModal">
        <div class="modal" style="max-width: 480px;">
            <div class="modal-header"><span class="modal-title">Connect Wallet</span><button class="modal-close" onclick="closeModal('walletModal')">&#xD7;</button></div>
            <div class="modal-body"><div class="wallet-grid" id="walletGrid"></div></div>
        </div>
    </div>
    <div class="wallet-error-toast" id="walletToast"></div>

    <!-- Vault Modal -->
    <div class="modal-overlay" id="vaultModal">
        <div class="modal" style="max-width: 520px;">
            <div class="modal-header"><span class="modal-title">Cortex Vault</span><button class="modal-close" onclick="closeModal('vaultModal')">&#xD7;</button></div>
            <div class="modal-body">
                <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:0.75rem;margin-bottom:1.25rem;padding:0.75rem;background:#f9f9f9;border:1px solid var(--border);">
                    <div><div style="font-size:0.55rem;color:var(--dim);margin-bottom:3px;">VAULT TVL</div><div id="vmTVL" style="font-size:0.85rem;font-family:var(--font-mono);">--</div></div>
                    <div><div style="font-size:0.55rem;color:var(--dim);margin-bottom:3px;">YOUR POSITION</div><div id="vmPosition" style="font-size:0.85rem;font-family:var(--font-mono);">--</div></div>
                    <div><div style="font-size:0.55rem;color:var(--dim);margin-bottom:3px;">YOUR SHARES</div><div id="vmShares" style="font-size:0.85rem;font-family:var(--font-mono);">--</div></div>
                </div>
                <div id="vmStateWarning" style="display:none;padding:0.5rem 0.75rem;background:#fff3cd;border:1px solid #cc8800;color:#cc8800;font-size:0.65rem;margin-bottom:1rem;"></div>
                <div style="display:flex;border-bottom:1px solid var(--border);margin-bottom:1rem;">
                    <button id="vmTabDeposit" class="btn btn-sm" onclick="vaultSwitchTab('deposit')" style="border:none;border-bottom:2px solid var(--fg);border-radius:0;font-size:0.65rem;padding:0.4rem 1rem;">Deposit</button>
                    <button id="vmTabWithdraw" class="btn btn-sm" onclick="vaultSwitchTab('withdraw')" style="border:none;border-bottom:2px solid transparent;border-radius:0;font-size:0.65rem;padding:0.4rem 1rem;color:var(--dim);">Withdraw</button>
                </div>
                <div id="vmDepositPanel">
                    <div style="margin-bottom:0.75rem;"><label style="font-size:0.6rem;color:var(--dim);display:block;margin-bottom:4px;">Token</label><select id="vmDepositToken" style="width:100%;padding:0.4rem 0.5rem;border:1px solid var(--border);font-family:var(--font-mono);font-size:0.7rem;background:var(--bg);color:var(--fg);"><option value="EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v">USDC (Mainnet)</option><option value="4zMMC9srt5Ri5X14GAgXhaHii3GnPAEERYPJgZJDncDU">USDC (Devnet)</option></select></div>
                    <div style="margin-bottom:0.5rem;"><label style="font-size:0.6rem;color:var(--dim);display:block;margin-bottom:4px;">Amount (USDC)</label><input id="vmDepositAmount" type="number" min="0" step="0.01" placeholder="0.00" style="width:100%;padding:0.5rem;border:1px solid var(--border);font-family:var(--font-mono);font-size:0.85rem;background:var(--bg);color:var(--fg);"><div style="display:flex;justify-content:space-between;margin-top:4px;"><span style="font-size:0.55rem;color:var(--dim);">Balance: <span id="vmDepositBalance">--</span> USDC</span><button onclick="vaultSetMaxDeposit()" style="background:none;border:none;font-size:0.55rem;color:var(--fg);cursor:pointer;text-decoration:underline;">MAX</button></div></div>
                    <div id="vmDepositPreview" style="display:none;margin-bottom:0.75rem;padding:0.5rem 0.75rem;background:#f5f5f5;font-size:0.65rem;color:var(--dim);">You will receive: <span id="vmDepositSharesPreview" style="color:var(--fg);font-family:var(--font-mono);">--</span> shares</div>
                    <button class="btn" onclick="executeDeposit()" id="vmDepositBtn" style="width:100%;font-size:0.7rem;padding:0.6rem;background:var(--fg);color:var(--bg);">Deposit</button>
                </div>
                <div id="vmWithdrawPanel" style="display:none;">
                    <div style="margin-bottom:0.75rem;"><label style="font-size:0.6rem;color:var(--dim);display:block;margin-bottom:4px;">Token</label><select id="vmWithdrawToken" style="width:100%;padding:0.4rem 0.5rem;border:1px solid var(--border);font-family:var(--font-mono);font-size:0.7rem;background:var(--bg);color:var(--fg);"><option value="EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v">USDC (Mainnet)</option><option value="4zMMC9srt5Ri5X14GAgXhaHii3GnPAEERYPJgZJDncDU">USDC (Devnet)</option></select></div>
                    <div style="margin-bottom:0.5rem;"><label style="font-size:0.6rem;color:var(--dim);display:block;margin-bottom:4px;">Shares to Withdraw</label><input id="vmWithdrawShares" type="number" min="0" step="1" placeholder="0" style="width:100%;padding:0.5rem;border:1px solid var(--border);font-family:var(--font-mono);font-size:0.85rem;background:var(--bg);color:var(--fg);"><div style="display:flex;justify-content:space-between;margin-top:4px;"><span style="font-size:0.55rem;color:var(--dim);">Your shares: <span id="vmWithdrawShareBalance">--</span></span><button onclick="vaultSetMaxWithdraw()" style="background:none;border:none;font-size:0.55rem;color:var(--fg);cursor:pointer;text-decoration:underline;">ALL</button></div></div>
                    <div id="vmWithdrawPreview" style="display:none;margin-bottom:0.75rem;padding:0.5rem 0.75rem;background:#f5f5f5;font-size:0.65rem;color:var(--dim);">You will receive: <span id="vmWithdrawAssetsPreview" style="color:var(--fg);font-family:var(--font-mono);">--</span> USDC</div>
                    <button class="btn" onclick="executeWithdraw()" id="vmWithdrawBtn" style="width:100%;font-size:0.7rem;padding:0.6rem;background:var(--fg);color:var(--bg);">Withdraw</button>
                </div>
                <div id="vmStatusMsg" style="display:none;margin-top:0.75rem;padding:0.5rem 0.75rem;font-size:0.65rem;border:1px solid var(--border);"></div>
            </div>
        </div>
    </div>

    <div class="api-heatmap-tooltip" id="apiTooltip"></div>
    <div class="agent-perf-tooltip" id="agentPerfTooltip"></div>

    <!-- Core Services -->
    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    <script src="js/guardian-service.js"></script>
    <script src="js/news-service.js"></script>
    <script src="js/regime-service.js"></script>
    <script src="js/agent-service.js"></script>
    <script src="js/dashboard-app.js"></script>
    <script src="js/dashboard-wallet.js"></script>
    <script src="js/toast.js"></script>
    <script src="https://unpkg.com/@solana/web3.js@1.95.8/lib/index.iife.min.js"></script>
    <script src="js/vault-sdk.js"></script>
    <script src="js/vault-ui.js"></script>

    <!-- UI State Manager -->
    <script>
    (function() {
        function updateUI() {
            var hero = document.getElementById('heroSection');
            var user = document.getElementById('userSection');
            var connected = typeof walletState !== 'undefined' && walletState && walletState.address;
            if (hero) hero.style.display = connected ? 'none' : '';
            if (user) user.style.display = connected ? '' : 'none';
        }

        var _orig = window.setWalletUI;
        window.setWalletUI = function(state) {
            if (typeof _orig === 'function') _orig(state);
            updateUI();
            // Sync hero regime
            var r = document.getElementById('regimeValue');
            var hr = document.getElementById('heroRegime');
            if (r && hr) hr.textContent = r.textContent;
        };

        window.addEventListener('load', function() {
            setTimeout(updateUI, 300);
            // Populate hero TVL
            setTimeout(function() {
                var t = document.getElementById('vaultTVL');
                var ht = document.getElementById('heroTVL');
                if (t && ht && t.textContent !== '--') ht.textContent = t.textContent;
            }, 3000);
        });

        // Nav helper (unused for now but ready)
        window.switchNav = function(el) {};
    })();
    </script>
</body>
</html>
